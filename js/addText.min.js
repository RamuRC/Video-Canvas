function writeText(){$("#c").one("mousedown",function(b){var c=b.pageX-this.offsetLeft+$("#c").position().left,b=b.pageY-this.offsetTop;$("#main").append("<div id='textAreaPopUp' style='position:absolute;top:"+b+"px;left:"+c+"px;z-index:30;'><textarea id='textareaTest' style='width:100px;height:50px;'></textarea>"+("<input type='button' value='save' id='saveText' onclick='saveTextFromArea("+b+","+c+");'></div>"))})} function saveTextFromArea(b,c){var f=$("textarea#textareaTest").val();$("textarea#textareaTest").remove();$("#saveText").remove();var a=document.getElementById("c").getContext("2d"),d=getLines(a,f,100);CanvasTextFunctions.enable(a);var g=0;a.strokeStyle="rgba(237,229,0,1)";a.shadowOffsetX=2;a.shadowOffsetY=2;a.shadowBlur=1;a.shadowColor="rgba(0,0,0,1)";$.each(d,function(){var e=++g;e*=24;var e=b-$("#c").position().top+e,d=c-$("#c").position().left;f=this;a.drawText("sans",16,d,e,f);a.save();a.restore()}); a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0;a.shadowColor="rgba(0,0,0,0)"}function getLines(b,c,f){var c=c.split(" "),a=[],d="",g=0;b.font="16px sans-serif";for(var e=0;e<c.length;e++){var h=c[e],g=b.measureText(d+h).width;g<f?d+=" "+h:(a.push(d),d=h);if(e===c.length-1){a.push(d);break}}return a};