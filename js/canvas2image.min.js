var Canvas2Image=function(){var o=!1,g=document.createElement("canvas");g.getContext("2d")&&(o=!0);if(!o)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var r=!!g.getContext("2d").getImageData,p=!!g.toDataURL,s=!!window.btoa,q=function(b){var e="";if(typeof b=="string")e=b;else for(var d=0;d<b.length;d++)e+=String.fromCharCode(b[d]);return btoa(e)},k=function(b){var e=document.createElement("img");e.src=b;return e},l=function(b,e,d){if(e&&d){var a=document.createElement("canvas"); a.width=e;a.height=d;a.style.width=e+"px";a.style.height=d+"px";a.getContext("2d").drawImage(b,0,0,b.width,b.height,0,0,e,d);return a}return b};return{saveAsPNG:function(b,e,d,a){if(!p)return!1;b=l(b,d,a).toDataURL("image/png");if(e)return k(b);else e=b.replace("image/png","image/octet-stream"),document.location.href=e;return!0},saveAsJPEG:function(b,e,d,a){if(!p)return!1;b=l(b,d,a).toDataURL("image/jpeg");if(b.indexOf("image/jpeg")!=5)return!1;if(e)return k(b);else e=b.replace("image/jpeg","image/octet-stream"), document.location.href=e;return!0},saveAsBMP:function(b,e,d,a){if(!r||!s)return!1;var b=l(b,d,a),d=parseInt(b.width),a=parseInt(b.height),f=b.getContext("2d").getImageData(0,0,d,a),b=[],d=f.width,i=f.height;b.push(66);b.push(77);a=d*i*3+54;b.push(a%256);a=Math.floor(a/256);b.push(a%256);a=Math.floor(a/256);b.push(a%256);a=Math.floor(a/256);b.push(a%256);b.push(0);b.push(0);b.push(0);b.push(0);b.push(54);b.push(0);b.push(0);b.push(0);a=[];a.push(40);a.push(0);a.push(0);a.push(0);var c=d;a.push(c%256); c=Math.floor(c/256);a.push(c%256);c=Math.floor(c/256);a.push(c%256);c=Math.floor(c/256);a.push(c%256);c=i;a.push(c%256);c=Math.floor(c/256);a.push(c%256);c=Math.floor(c/256);a.push(c%256);c=Math.floor(c/256);a.push(c%256);a.push(1);a.push(0);a.push(24);a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);c=d*i*3;a.push(c%256);c=Math.floor(c/256);a.push(c%256);c=Math.floor(c/256);a.push(c%256);c=Math.floor(c/256);a.push(c%256);for(c=0;c<16;c++)a.push(0);var c=(4-d*3%4)%4,f=f.data,g="";do{for(var h=d* (i-1)*4,j="",m=0;m<d;m++){var n=4*m;j+=String.fromCharCode(f[h+n+2]);j+=String.fromCharCode(f[h+n+1]);j+=String.fromCharCode(f[h+n])}for(h=0;h<c;h++)j+=String.fromCharCode(0);g+=j}while(--i);b=q(b.concat(a))+q(g);if(e)return k("data:image/bmp;base64,"+b);else document.location.href="data:image/octet-stream;base64,"+b;return!0}}}();