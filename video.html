<!-- 
References:
	http://html5doctor.com/video-canvas-magic/
	http://www.nihilogic.dk/labs/canvas2image/
	http://www.williammalone.com/articles/create-html5-canvas-javascript-drawing-app/
	http://dev.opera.com/articles/view/custom-html5-video-player-with-css3-and-jquery/
	http://www.lutzroeder.com/html5/
	http://jim.studt.net/canvastext/
-->
<!DOCTYPE html>
<html>
<head>
	<style>
		body {
			background: #111;
			color:#eee;
		}
		#c {
			width: 640px;
			height: 360px;
			float: left;
		}
		#v {
			display:none;
			width:640px;
			height:360px;
		}
		#main{
			width:650px;
			margin:auto;
		}
		.toolList{
			float:left;
			width:100%;
		}
	</style>
	<link href="css/ghindaVideoPlayer.css" rel="stylesheet" type="text/css">
</head>
<body>
	<div id="main">
		<span id="testText">Video Write-On Annotations</span>
		<canvas id="c"></canvas><!-- the canvas -->
		<video width="640" height="360" autobuffer="true" controls="true" poster="http://www.travisberry.com/html5video/videos/demo/demoani1-poster.jpg" id="v" tabindex="0">
			<source src="videos/sintel-trailer.ogv" type='video/ogg; codecs="theora, vorbis"'>
			<source src="videos/sintel-trailer.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
		</video>
		<!-- The video controls-->
		<div class="ghinda-video-controls">
			<a class="ghinda-video-play" title="Play/Pause"></a>
			<div class="ghinda-video-seek"></div>
			<div class="ghinda-video-timer">00:00</div>
			<div class="ghinda-volume-box">
				<div class="ghinda-volume-slider"></div>
				<a class="ghinda-volume-button" title="Mute/Unmute"></a>
			</div>
		</div>
		<!-- Draw controls -->
		<ul class="toolList">
			<li>Clear the canvas: <button type="button" id="clearCanvas">Clear</button></li>
			<li><span class="highlight">Choose a color: </span><button type="button" id="choosePurpleColors">Purple</button><button type="button" id="chooseGreenColors">Green</button><button type="button" id="chooseYellowColors">Yellow</button><button type="button" id="chooseBrownColors">Brown</button></li>
			<li><span class="highlight">Choose a size: </span><button type="button" id="chooseSmallSizes">Small</button><button type="button" id="chooseNormalSizes">Normal</button><button type="button" id="chooseLargeSizes">Large</button><button type="button" id="chooseHugeSizes">Huge</button></li>
			<li><button type="button" id="chooseWhiteColors">Eraser</button></li>
			<li><button type="button" id="chooseWhiteColors" onclick="writeText();">Text</button></li>
		</ul>
		<!-- Save image-->
		<div style="display: block; float:left;" id="buttoncontainer">
			<input type="button" value="Save PNG" id="savepngbtn">
			<input type="button" value="Convert to PNG" id="convertpngbtn">
			<br>
			<input type="button" value="Save BMP" id="savebmpbtn">
			<input type="button" value="Convert to BMP" id="convertbmpbtn">
			<br>
			<input type="button" value="Save JPEG" id="savejpegbtn">
			<input type="button" value="Convert to JPEG" id="convertjpegbtn">
		</div>
		<div style="display: none; font-style: italic;" id="textdownload">Now you can right click and download the image<br>
			<input type="button" value="Reset" id="resetbtn">
		</div>
	</div><!-- End #main -->
	
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/jquery-ui.min.js"></script><!-- Needed by player controls-->
	<script type="text/javascript" src="js/canvas2image.min.js"></script><!-- Needed to save image to desktop-->
	<script type="text/javascript" src="js/base64.min.js"></script><!-- Needed to save image to desktop-->
	<!--[if IE]><script type="text/javascript" src="excanvas.js"></script><![endif]-->
	<script type="text/javascript" src="js/videoToCanvas.min.js"></script>
	<script type="text/javascript" src="js/canvasDraw.min.js"></script>
	<script src="js/jquery.ghindaVideoPlayer.min.js"></script><!-- Player controls script-->
	<script>
		//instantiate player controls
		$(function() {
			$('#v').gVideo();		
		});
	</script>
	<script type="text/javascript" src="js/saveImage.min.js"></script>
	
	<script type="text/javascript" src="js/text.js"></script>
	<script type="text/javascript">
	function writeText(){
		$("#c").one('mousedown', function(e) {
		  //alert('Handler for .click() called.');
			var mouseX = e.pageX - this.offsetLeft + 456;
			var mouseY = e.pageY - this.offsetTop;
			//alert(mouseX);
			var textArea = "<div id='textAreaPopUp' style='position:absolute;top:"+mouseY+"px;left:"+mouseX+"px;z-index:30;'><textarea id='textareaTest' style='width:100px;height:50px;'></textarea>";
			var saveButton = "<input type='button' value='save' id='saveText' onclick='saveTextFromArea("+mouseY+","+mouseX+");'></div>";
			var appendString = textArea + saveButton;
			$("#main").append(appendString);
		});
	}
	function saveTextFromArea(y,x){
		//get the value of the textarea then destroy it and the save button
		var text = $('textarea#textareaTest').val();
		$('textarea#textareaTest').remove();
		$('#saveText').remove();
		//get the canvas and add the text functions
		var canvas = document.getElementById('c');
		var ctx = canvas.getContext('2d');
		// this adds the text functions to the ctx
		CanvasTextFunctions.enable(ctx);
		//set the font styles
		var font = "sans";
		var fontsize = 16;
		ctx.strokeStyle = "rgba(205,205,205,1)";
		//set the placement in the canvas
		var topPlacement = y - $("#c").position().top;
		var leftPlacement = x - $("#c").position().left;
		//draw the text
		ctx.drawText(font, fontsize, leftPlacement, topPlacement, text);
		ctx.save();
		ctx.restore();
	}
	</script>
</body>
</html>